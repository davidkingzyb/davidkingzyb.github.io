<!DOCTYPE html>
<html>
<head>
	<title>DKZ's Blog</title>
	<meta charset="utf-8">
	<meta name="viewport"
          content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
	<link rel="stylesheet" type="text/css" href="../res/md.css">
	<link rel="stylesheet" type="text/css" href="../res/style.css">
	<script type="text/javascript" src="blogImg/blogmd.js"></script>
</head>
<body>
	<div id="container">
		<a href="#top">
			<div id="headPane">
			<div id="headmain">
				<canvas id="dkzlogo" width="340" height="250">
					<img src="/res/img/dkzlogo.png">
				</canvas>
			</div>

		</div>
		</a>
		<div id="bodyPane"><article class="markdown-body"><h1>
<a id="user-content-isometric-projection" class="anchor" href="#isometric-projection" aria-hidden="true"><span class="octicon octicon-link"></span></a>isometric projection</h1>

<p><strong>等角投影制作egret伪3D游戏</strong></p>

<p>2015/9/3 by DKZ thx. May</p>

<p>最近在制作一款类似cubejump的游戏伪3D游戏，接下来cubex3的手机版也要想要使用等角投影制作。</p>

<p>感谢剑龙写的egret版本的等角投影库，我简单研究了下原理，可能下面的笔记会有错误，具体请参考《Flash ActionScript 3.0 动画高级教程》</p>

<p>简单的说等角变换是将三维世界的点变化成为二维平面上的坐标来确定对象的位置，在游戏中实现伪3D效果</p>

<h2>
<a id="user-content-原理" class="anchor" href="#%E5%8E%9F%E7%90%86" aria-hidden="true"><span class="octicon octicon-link"></span></a>原理</h2>

<p>三维空间点p(px,py,pz)沿y轴旋转angleY沿x轴旋转angleX得到二维平面上点(x,y)和深度z</p>

<p>x=px<em>cos(angleY)-pz</em>sin(angleY)</p>

<p>tempz=pz<em>cos(angleY)+px</em>sin(angleY)</p>

<p>y=py<em>cos(angleX)-tempz</em>sin(angleX)</p>

<p>z=tempz<em>cos(angleX)+py</em>sin(angleX)</p>

<p>等角变换angleY=45°，angleX=-30°带入消去tempz再乘2的平方根（变为2等角，w=h*2）</p>

<p>最终化简为：</p>

<p>x=px-pz</p>

<p>y=py<em>1.2247+(px+pz)</em>0.5</p>

<p>z=(px+pz)<em>0.886-y</em>0.707</p>

<p>二维变三维将py设为0可计算px，pz</p>

<p>px=y+x*0.5</p>

<p>py=0</p>

<p>pz=y-x*0.5</p>

<h2>
<a id="user-content-使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用</h2>

<p>可以前往<a href="https://github.com/davidkingzyb/egretInit">egretInit</a>获得这个库</p>

<p>其中主要包括</p>

<h3>
<a id="user-content-point3dts" class="anchor" href="#point3dts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Point3D.ts</h3>

<p>三维空间点类</p>

<h3>
<a id="user-content-isoutilsts" class="anchor" href="#isoutilsts" aria-hidden="true"><span class="octicon octicon-link"></span></a>IsoUtils.ts</h3>

<p>换算坐标类</p>

<h5>
<a id="user-content-isotoscreenp3dpoint3degretpoint" class="anchor" href="#isotoscreenp3dpoint3degretpoint" aria-hidden="true"><span class="octicon octicon-link"></span></a>isoToScreen(p3d:Point3D):egret.Point</h5>

<p>三维到二维</p>

<h5>
<a id="user-content-xyztoxyxyz" class="anchor" href="#xyztoxyxyz" aria-hidden="true"><span class="octicon octicon-link"></span></a>XYZToXY(x,y,z)</h5>

<p>三维到二维</p>

<h5>
<a id="user-content-screentoisop2degretpointpoint3d" class="anchor" href="#screentoisop2degretpointpoint3d" aria-hidden="true"><span class="octicon octicon-link"></span></a>screenToIso(p2d:egret.Point):Point3D</h5>

<p>二维到三维</p>

<h3>
<a id="user-content-isoobjectts" class="anchor" href="#isoobjectts" aria-hidden="true"><span class="octicon octicon-link"></span></a>IsoObject.ts</h3>

<p>等角投影对象类，所有显示对象都要扩展这个类</p>

<h5>
<a id="user-content-_pxnumber" class="anchor" href="#_pxnumber" aria-hidden="true"><span class="octicon octicon-link"></span></a>_px:number</h5>

<h5>
<a id="user-content-_pynumber" class="anchor" href="#_pynumber" aria-hidden="true"><span class="octicon octicon-link"></span></a>_py:number</h5>

<h5>
<a id="user-content-_pznumber" class="anchor" href="#_pznumber" aria-hidden="true"><span class="octicon octicon-link"></span></a>_pz:number</h5>

<h5>
<a id="user-content-_positionpoint3d" class="anchor" href="#_positionpoint3d" aria-hidden="true"><span class="octicon octicon-link"></span></a>_position:Point3D</h5>

<p>三维坐标和三维点</p>

<h5>
<a id="user-content-_widthnumber" class="anchor" href="#_widthnumber" aria-hidden="true"><span class="octicon octicon-link"></span></a>_width:number</h5>

<h5>
<a id="user-content-_heightnumber" class="anchor" href="#_heightnumber" aria-hidden="true"><span class="octicon octicon-link"></span></a>_height:number</h5>

<p>显示对象宽和高用于碰撞检测或显示对象排布</p>

<h5>
<a id="user-content-_walkableboolean--false" class="anchor" href="#_walkableboolean--false" aria-hidden="true"><span class="octicon octicon-link"></span></a>_walkable:boolean = false</h5>

<h5>
<a id="user-content-_vxnumber--0" class="anchor" href="#_vxnumber--0" aria-hidden="true"><span class="octicon octicon-link"></span></a>_vx:number = 0</h5>

<h5>
<a id="user-content-_vynumber--0" class="anchor" href="#_vynumber--0" aria-hidden="true"><span class="octicon octicon-link"></span></a>_vy:number = 0</h5>

<h5>
<a id="user-content-_vznumber--0" class="anchor" href="#_vznumber--0" aria-hidden="true"><span class="octicon octicon-link"></span></a>_vz:number = 0</h5>

<p>三维空间中三个方向的运动速度</p>

<h5>
<a id="user-content-updatescreenpositionvoid" class="anchor" href="#updatescreenpositionvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>updateScreenPosition():void</h5>

<p>调用IsoUtils计算并更新二维平面中的位置</p>

<h5>
<a id="user-content-setpositionxyzvoid" class="anchor" href="#setpositionxyzvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>setPosition(x,y,z):void</h5>

<p>设置三维空间中位置</p>

<h5>
<a id="user-content-get-depth" class="anchor" href="#get-depth" aria-hidden="true"><span class="octicon octicon-link"></span></a>get depth()</h5>

<p>获得深度</p>

<h5>
<a id="user-content-updatepnumber--1void" class="anchor" href="#updatepnumber--1void" aria-hidden="true"><span class="octicon octicon-link"></span></a>update(p:number = 1):void</h5>

<p>更新位置（用在frame loop中）</p>

<h3>
<a id="user-content-isoworldts" class="anchor" href="#isoworldts" aria-hidden="true"><span class="octicon octicon-link"></span></a>IsoWorld.ts</h3>

<p>等角投影世界</p>

<h5>
<a id="user-content-_flooregretdisplayobjectcontainer" class="anchor" href="#_flooregretdisplayobjectcontainer" aria-hidden="true"><span class="octicon octicon-link"></span></a>_floor:egret.DisplayObjectContainer</h5>

<p>地面容器（不参与深度排序）</p>

<h5>
<a id="user-content-_worldegretdisplayobjectcontainer" class="anchor" href="#_worldegretdisplayobjectcontainer" aria-hidden="true"><span class="octicon octicon-link"></span></a>_world:egret.DisplayObjectContainer</h5>

<p>世界容器（参与深度排序）</p>

<h5>
<a id="user-content-_objectsisoobject--" class="anchor" href="#_objectsisoobject--" aria-hidden="true"><span class="octicon octicon-link"></span></a>_objects:IsoObject[] = []</h5>

<p>等角变换对象数组</p>

<h5>
<a id="user-content-addchildtoworldchildisoobjectvoid" class="anchor" href="#addchildtoworldchildisoobjectvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>addChildToWorld(child:IsoObject):void</h5>

<p>添加一个等角变换对象到世界中</p>

<h5>
<a id="user-content-removechildfromworldchildisoobjectvoid" class="anchor" href="#removechildfromworldchildisoobjectvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>removeChildFromWorld(child:IsoObject):void</h5>

<p>从世界删除一个等角变换对象</p>

<h5>
<a id="user-content-addchildtofloorchildisoobjectvoid" class="anchor" href="#addchildtofloorchildisoobjectvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>addChildToFloor(child:IsoObject):void</h5>

<p>添加一个等角变换对象到地板中</p>

<h5>
<a id="user-content-removechildfromfloorchildisoobjectvoid" class="anchor" href="#removechildfromfloorchildisoobjectvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>removeChildFromFloor(child:IsoObject):void</h5>

<p>从地板删除一个等角变换对象</p>

<h5>
<a id="user-content-sortvoid" class="anchor" href="#sortvoid" aria-hidden="true"><span class="octicon octicon-link"></span></a>sort():void</h5>

<p>对等角变换世界排序</p>

<h3>
<a id="user-content-bitmaptilets" class="anchor" href="#bitmaptilets" aria-hidden="true"><span class="octicon octicon-link"></span></a>BitmapTile.ts</h3>

<p>等角投影位图 extends IsoObject</p>

<p>设计师注意位图使用二等角长宽比1:2（或根据需要定制此类）</p>

<p>其他还有几个扩展IsoObject的类可以用作参考</p>
</article>
<article class="markdown-body">
<!-- 多说评论框 start -->
	<div id="discusspane"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"davidkingzyb"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

</article>
</div>
	</div>
<div id="footer">
	<div id="footerPane">
		<img id="cubehead" src="../res/img/cubehead.png">
		<div id="footerL">
			<a href="../index.html">Home</a><a href="../index.html#contact">Contact</a>
		</div>
		<div id="footerR">
			<a id="search">Search</a><a href="../blog.html">Contents</a><a href="#top">Top</a>
		</div>

	</div>
</div>
</body>
</html>