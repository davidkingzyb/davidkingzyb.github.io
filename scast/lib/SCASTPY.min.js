var SCASTPY=function(){var e={num:!1,kw:!1,id:!1,str:!1,punc:!1,sp:!1,op:!1,t:!1,Comment:!1,ClassDefine:!0,MethodDefine:!0,PropertyDefine:!0,Variable:!0,CallExpression:!0,FunctionDefine:!0,LoopStatement:!0,IfStatement:!0,BlockStatement:!0,Expression:!1,Condition:!1,Arguments:!1,Arg:!1,ArrayExpression:!0,ObjectExpression:!0,TupleExpression:!0,WithStatement:!0,MemberExpression:!0,TryStatement:!0,ExceptStatement:!0,FinallyStatement:!0,Lambda:!0};function t(e){var t,n=null,o=["False","None","True","and","as","assert","async","await","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","nonlocal","not","or","pass","raise","return","try","while","with","yield"];return{next:function(){var e=n;return n=null,e||d()},peek:c,eof:function(){return null==c()},croak:e.croak};function i(e){return/[0-9]/i.test(e)}function l(e){return/[a-zA-Z$_@]/i.test(e)}function r(e){return l(e)||"0123456789".indexOf(e)>=0}function a(e){return"+-*/%=&|<>!^\\".indexOf(e)>=0}function u(e){return" \t".indexOf(e)>=0}function p(t){for(var n="";!e.eof()&&t(e.peek());)n+=e.next();return n}function f(t){var n=!1,o="";for(e.next();!e.eof();){var i=e.next();if(n)o+=i,n=!1;else if("\\"==i)n=!0;else{if(i==t)break;o+=i}}return o}function s(n){return{type:"str",value:f(n),poi:{line:t.line,start:t.column,end:e.poi().column}}}function d(){if(p(u),e.eof())return null;var n,f,d,c,v=e.peek();return t=e.poi(),"\n"==v?function(n){var o="";for(e.next();!e.eof()&&n(e.peek());)o+=e.next();return{type:"t",value:o,poi:{line:t.line,start:t.column,end:e.poi().column}}}(u):"#"==v||"/"==v&&"/"==e.peek(1)?{type:"Comment",value:p((function(e){return"\n"!=e})),poi:{line:t.line,start:t.column,end:e.poi().column}}:'"'==v?s('"'):"'"==v?s("'"):i(v)?(n=!1,f=p((function(e){return"."==e?!n&&(n=!0,!0):i(e)})),{type:"num",value:parseFloat(f),poi:{line:t.line,start:t.column,end:e.poi().column}}):l(v)?(c=p(r),{type:(d=c,o.indexOf(d)>=0?"kw":"id"),value:c,poi:{line:t.line,start:t.column,end:e.poi().column}}):function(e){return"(){}[]".indexOf(e)>=0}(v)?{type:"punc",value:e.next(),poi:{line:t.line,start:t.column,end:e.poi().column}}:function(e){return",;.:?".indexOf(e)>=0}(v)?{type:"sp",value:e.next(),poi:{line:t.line,start:t.column,end:e.poi().column}}:a(v)?{type:"op",value:p(a),poi:{line:t.line,start:t.column,end:e.poi().column}}:void e.croak(`Can't handle character :${v}(${v.charCodeAt(0)})`)}function c(){return n||(n=d())}}function n(e){var t=!1;return function(){var t=[];for(;!e.eof();)t.push(w());return{type:"top",body:t}}();function n(t){var n=e.peek();return n&&"kw"==n.type&&(!t||n.value==t)&&n}function o(t){var n=e.peek();return n&&"punc"==n.type&&(!t||n.value==t)&&n}function i(t){var n=e.peek();return n&&"sp"==n.type&&(!t||n.value==t)&&n}function n(t){var n=e.peek();return n&&"kw"==n.type&&(!t||n.value==t)&&n}function l(t){var n=e.peek();return n&&"op"==n.type&&(!t||n.value==t)&&n}function r(){return"id"==e.peek().type}function a(t){o(t)?e.next():e.croak('Expecting punctuation: "'+t+'"')}function u(){if(i(","))return void(i(t=",")?e.next():e.croak('Expecting punctuation: "'+t+'"'));var t;let l=null;if(r()){if(l=e.next(),o("("))return{type:"CallExpression",value:l.value,poi:{line:l.poi.line,start:l.poi.start},body:[p()]}}else{if(n("lambda"))return y();l=e.next()}return{type:"Arg",value:l.value,node:l,poi:l.poi}}function p(){var t={type:"Arguments",body:[],poi:{line:e.peek().poi.line,start:e.peek().poi.start},value:""};for(a("(");!o(")");){var n=u();n&&(t.value+=n.value+" ",t.body.push(n))}return a(")"),t}function f(t){var n={line:e.peek().poi.line,start:e.peek().poi.start},o=[];e.next();for(var i=e.peek();"t"!=i.type||0===i.value.length;)i=e.next();for(;e.peek()&&("t"!=e.peek().type||"t"==e.peek().type&&e.peek().value==i.value);){var l=w(t);l&&o.push(l)}return{type:"BlockStatement",body:o,poi:n,indentation:i}}function s(){for(var t={type:"Condition",poi:{line:e.peek().poi.line,start:e.peek().poi.start},value:"",body:[]};!i(":");){let n=null;r()?(t.value+=e.peek().value+" ",n=e.next(),o("(")&&t.body.push({type:"CallExpression",value:n.value,poi:{line:n.poi.line,start:n.poi.start},body:[p()]})):(n=e.next(),t.value+=n.value+" ",t.body.push(n))}return t}function d(){for(var t=e.next(),n=[],i={line:t.poi.line,start:t.poi.start},l="";"]"!=e.peek().value;){let t=e.next();o("[")&&n.push(d()),o("(")&&n.push(c()),o("{")&&n.push(v()),l+=t.value,n.push(t)}return e.next(),{type:"ArrayExpression",value:l,body:n,poi:i}}function c(){for(var t=e.next(),n=[],i={line:t.poi.line,start:t.poi.start},l="";")"!=e.peek().value;){let t=e.next();o("[")&&n.push(d()),o("(")&&n.push(c()),o("{")&&n.push(v()),l+=t.value,n.push(t)}return e.next(),{type:"TupleExpression",value:l,body:n,poi:i}}function v(){for(var t=e.next(),n=[],i={line:t.poi.line,start:t.poi.start},l="";"}"!=e.peek().value;){let t=e.next();o("[")&&n.push(d()),o("(")&&n.push(c()),o("{")&&n.push(v()),l+=t.value,n.push(t)}return e.next(),{type:"ObjectExpression",value:l,body:n,poi:i}}function y(){var t=e.peek(),n={type:"Lambda",value:t.value,poi:{line:t.poi.line,start:t.poi.start},body:[]};e.next();for(var l={type:"Arguments",body:[],poi:{line:e.peek().poi.line,start:e.peek().poi.start},value:""};!i(":");){let t=e.next();l.body.push(t),l.value+=t.value}for(n.arguments=l;!i(",")&&!o()&&"t"!=e.peek().type;){let t=e.next();n.body.push(t)}return n}function _(t){return r()?function(t){var n=e.next();if(o("("))return{type:"CallExpression",value:n.value,poi:{line:n.poi.line,start:n.poi.start},body:[p()]};if(l("=")||l("+=")||l("-=")||l("*=")||l("/=")||l("%=")||l("**=")||l("//=")){e.next();var r={type:"Variable",value:n.value,poi:{line:n.poi.line,start:n.poi.start},body:[_()]};return t&&(r.type="PropertyDefine"),r}if(i(".")){e.next();let t=e.peek();return{type:"MemberExpression",value:n.value,poi:{line:t.poi.line,start:t.poi.start},body:[_()]}}return n}(t):o("[")?d():o("(")?c():o("{")?v():n("lambda")?y():n()?(a=e.peek(),u={type:"Expression",value:a.value,poi:{line:a.poi.line,start:a.poi.start}},e.next(),e.peek()&&(u.body=[_()]),u):e.next();var a,u}function w(u){try{return n("def")?function(){e.next();var n={type:"FunctionDefine",value:e.peek().value,poi:{start:e.peek().poi.start,line:e.peek().poi.line}};if(e.next(),o("(")&&(n.arguments=p()),l("->"))for(e.next(),n.return=e.peek();!i(":");)e.next();i(":")&&(n.body=f().body);for(let e of n.arguments.body)if("self"==e.value&&t){n.type="MethodDefine";break}return n}():n("if")||n("elif")||n("else")?(c=e.next(),v={type:"IfStatement",poi:{line:c.poi.line,start:c.poi.start},value:c.value},i(":")?(v.body=f().body,v):(v.condition=s(),i(":")&&(v.body=f().body),v)):n("for")||n("while")?function(){var t=e.next(),n={type:"LoopStatement",value:t.value,poi:{line:t.poi.line,start:t.poi.start},condition:s()};return i(":")&&(n.body=f().body),n}():n("with")?function(){var t=e.next(),n={type:"WithStatement",value:t.value,poi:{line:t.poi.line,start:t.poi.start},condition:s()};return i(":")&&(n.body=f().body),n}():n("try")?function(){var t=e.next();return{type:"TryStatement",poi:{line:t.poi.line,start:t.poi.start},value:t.value,body:f().body}}():n("except")?function(){var t=e.next(),n={type:"ExceptStatement",poi:{line:t.poi.line,start:t.poi.start},value:t.value};return n.condition=s(),i(":")&&(n.body=f().body),n}():n("finally")?function(){var t=e.next();return{type:"FinallyStatement",poi:{line:t.poi.line,start:t.poi.start},value:t.value,body:f().body}}():n("class")?function(){e.next();var n={type:"ClassDefine",value:e.peek().value,poi:{start:e.peek().poi.start,line:e.peek().poi.line},extends:[]};if(e.next(),o("(")){for(;!o(")");)e.next(),r()&&n.extends.push(e.peek());a(")")}return t=!0,i(":")&&(n.body=f(!0).body),console.log("class",n,t),t=!1,n}():_(u)}catch(t){var d=e.peek();console.warn(`parse statement ${d.type} ${d.value} at ${d.poi.line}:${d.poi.start}:${d.poi.end}`,t)}var c,v}}var o={scastops:e,fontsize:14};return{getAst:function(e){return n(t(function(e){var t=0,n=1,o=0;return{next:function(){var i=e.charAt(t++);return"\n"==i?(n++,o=0):o++,i},peek:i,eof:function(){return""==i()},croak:function(e){throw new Error(e+" ("+n+":"+o+")")},poi:function(){return{line:n,column:o,pos:t}}};function i(n=0){return e.charAt(t+n)}}(e)))},traverseAst:function e(t,n){if(!0!==n(t)&&t.body&&t.body.length>0)for(let o of t.body)e(o,n)},analysisMermaid:function(e,t,n){switch(e.type){case"FunctionDefine":return i(e,{},t),!0;case"ClassDefine":if(!n.showMethod)break;return function(e,t){if(e._file=t,e._flow_id=e.value,!1===n.FlowFilter[e.value])return;n.FlowNode[e._flow_id]=e,n.FlowOne[e._flow_id]=e.value,n.Flow+=`    ${e.value}[${e.value}]\nclick ${e.value} "javascript:void(onFlowClick('${e.value}','${t}'))"\n`,n.FDPNode[e._flow_id]={id:e.value,w:e.value.length*gD3fontSize/1.6+2*gD3fontSize,text:`[${e.value}]`},n.UMLClass[e.value]={},n.UML+=`  class ${e.value}{\n`;for(let l of e.body)switch(l.type){case"MethodDefine":l._flow_id=l.value,i(l,e,t,!0);break;case"PropertyDefine":o(l,e,t,n)}n.UML+="  }\n";for(let t of e.extends){let o=t.value;void 0===n.FDPNode[o]&&(n.FDPNode[o]={id:o,w:o.length*gD3fontSize/1.6+2*gD3fontSize,text:`[${o}]`}),n.UML+=`  ${o} <|-- ${e.value}\n`,n.FlowLink+=`${o} ==o ${e.value}\n`,n.FDPLinks.push({source:o,target:e.value,value:6,dist:200,dash:"2,2"})}}(e,t),!0}function o(e,t,n,o){if(e._flow_id=e.value,e._flow_prop=`|${e.value.replaceAll("|","|").replaceAll("[","").replaceAll("]","")}|`,o.UML+=`    ${e.value}\n`,!o.showCall)return!0;for(let i of e.body)if("CallExpression"==i.type)return i._file=n,i._flow_id=i.value+"_"+e._flow_id,i._flow_from=t._flow_id,i._flow_prop=e._flow_prop,o.FlowNode[i._flow_id]=i,!o.FlowFilter[i._flow_id]||(i._flow_str=`        ${i._flow_id}([${i.value}])\nclick ${i._flow_id} "javascript:void(onFlowClick('${i._flow_id}','${n}'))"\n`,o.FDPNode[i._flow_id]={id:i._flow_id,w:i.value.length*gD3fontSize/1.6+2*gD3fontSize,text:i.value+"()"},o.Flow+=i._flow_str,!0)}function i(e,t,o,i){var r=t.value?e.value+"_"+t.value:e.value;if(n.FlowOne[e.value]=r,e._flow_id=r,e._flow_from=t.value,e._file=o,!1!==n.FlowFilter[e._flow_id]&&(n.FlowNode[e._flow_id]=e,n.FDPNode[e._flow_id]={id:e._flow_id,w:e.value.length*gD3fontSize/1.6+3*gD3fontSize,text:`${e.value}()`},i&&(n.UML+=`    ${e.value}()\n`),n.Flow+=`    ${e._flow_id}([${e.value}])\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${o}'))"\n`,t._flow_id&&(n.FlowLink+=`${t._flow_id} --o ${e._flow_id}\n`,n.FDPLinks.push({source:t._flow_id,target:e._flow_id,value:2})),n.showCall&&e.body))for(let t of e.body)l(t,e,r)}function l(e,o,r){if(e)if(e._file=t,e._flow_id=e.value+"_"+o._flow_id,e._flow_from=n.showIf?o._flow_id:r,n.FlowNode[e._flow_id]=e,"FunctionDefine"==e.type||"MethodDefine"==e.type)i(e,o,t);else if("LoopStatement"==e.type){if(n.showIf&&(n.Flow+=`         ${e._flow_id}((${e.value}))\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${t}'))"\n`,n.FDPNode[e._flow_id]={id:e._flow_id,w:0,text:"🔵"}),e.condition&&e.condition.value&&(e._flow_condition="|"+e.condition.value.replaceAll("|","｜").replaceAll("[","⌈").replaceAll("]","⌋")+"|"),e.body)for(let t of e.body)l(t,e,r)}else if("IfStatement"==e.type){if(n.showIf&&(n.Flow+=`        ${e._flow_id}{${e.value}}\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${t}'))"\n`,n.FDPNode[e._flow_id]={id:e._flow_id,w:0,text:"🔷"}),e.condition&&e.condition.value&&(e._flow_condition="|"+e.condition.value.replaceAll("|","｜").replaceAll("[","⌈").replaceAll("]","⌋")+"|"),e.body)for(let t of e.body)l(t,e,r)}else if("CallExpression"==e.type){if(n.FlowNode[e._flow_id]=e,!n.FlowFilter[e._flow_id])return!0;e._flow_str=`        ${e._flow_id}([${e.value}])\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${t}'))"\n`,n.FDPNode[e._flow_id]={id:e._flow_id,w:e.value.length*gD3fontSize/1.6+2*gD3fontSize,text:e.value+"()"},n.Flow+=e._flow_str}else if(("Variable"==e.type||"Expression"==e.type||"WithStatement"==e.type||"TryStatement"==e.type||"ExceptStatement"==e.type||"FinallyStatement"==e.type||"MemberExpression"==e.type)&&(e._flow_id=o._flow_id,e.body))for(let t of e.body)l(t,e,r)}},analysisD3:function(e,t){if(e.children=[],e.body&&e.body.length>0)for(let t of e.body)(o.scastops[t.type]||o.scastops.all)&&e.children.push(t);switch(e.type){case"top":e.name=t,e.value=t;break;case"ClassDefine":e.name=`[ ${e.value} ]`;break;case"MethodDefine":case"FunctionDefine":e.name=`${e.value}()`;break;case"PropertyDefine":e.name=`${e.value}`;break;case"CallExpression":e.name=e.value+"()";break;default:e.name=e.value}},setD3Config:function(e){o=e},types:e,loc2poi:function(e){return e.poi},setCode:function(){}}}();ESTREEPY=SCASTPY;