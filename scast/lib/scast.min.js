var SCAST=function(){var e={num:!1,kw:!1,id:!1,str:!1,punc:!1,sp:!1,op:!1,t:!1,Comment:!1,ClassDefine:!0,InterfaceDefine:!0,NamespaceDefine:!0,MethodDefine:!0,PropertyDefine:!0,Variable:!0,NewExpression:!0,CallExpression:!0,FunctionDefine:!0,LoopStatement:!0,IfStatement:!0,BlockStatement:!0,Expression:!1,Condition:!1,Arguments:!1,Arg:!1,ArrayExpression:!0,ObjectExpression:!0,TupleExpression:!0,WithStatement:!0,MemberExpression:!0,TryStatement:!0,ExceptStatement:!0,FinallyStatement:!0,Lambda:!0};function o(e){var o,t=null,n=["break","do","in","typeof","case","else","instanceof","var","catch","export","new","void","class","extends","return","while","const","finally","super","with","continue","for","switch","yield","debugger","function","this","default","if","throw","delete","import","try","constructor","super"],l=["abstract","as","base","bool","break","byte","case","catch","char","checked","class","const","continue","decimal","default","delegate","do","double","else","enum","event","explicit","extern","false","finally","fixed","float","for","foreach","goto","if","implicit","in","int","interface","internal","is","lock","long","namespace","new","null","object","operator","out","override","params","private","protected","public","readonly","ref","return","sbyte","sealed","short","sizeof","stackalloc","static","string","struct","switch","this","throw","true","try","typeof","uint","ulong","unchecked","unsafe","ushort","using","virtual","void","volatile","while","add","and","alias","ascending","args","async","await","by","descending","dynamic","equals","from","get","global","group","init","into","join","let","nameof","nint","not","notnull","nuint","on","or","orderby","partial","partial","record","remove","select","set","unmanaged","value","var","when","where","with","yield"];return{next:function(){var e=t;return t=null,e||d()},peek:v,eof:function(){return null==v()},croak:e.croak};function i(e){return/[0-9]/i.test(e)}function a(e){return/[a-zA-Z$_]/i.test(e)}function r(e){return a(e)||"0123456789".indexOf(e)>=0}function u(e){return"+-*/%=&|<>!^\\".indexOf(e)>=0}function s(e){return" \t\n".indexOf(e)>=0}function f(o){for(var t="";!e.eof()&&o(e.peek());)t+=e.next();return t}function p(o){var t=!1,n="";for(e.next();!e.eof();){var l=e.next();if(t)n+=l,t=!1;else if("\\"==l)t=!0;else{if(l==o)break;n+=l}}return n}function c(t){return{type:"str",value:p(t),poi:{line:o.line,start:o.column,end:e.poi().column}}}function d(){if(f(s),e.eof())return null;var t,p,d,v,_=e.peek();return o=e.poi(),"#"==_||"/"==_&&"/"==e.peek(1)?{type:"Comment",value:f((function(e){return"\n"!=e})),poi:{line:o.line,start:o.column,end:e.poi().column}}:'"'==_?c('"'):"'"==_?c("'"):"`"==_?c("`"):i(_)?(t=!1,p=f((function(e){return"."==e?!t&&(t=!0,!0):i(e)})),{type:"num",value:parseFloat(p),poi:{line:o.line,start:o.column,end:e.poi().column}}):a(_)?(v=f(r),{type:(d=v,n.indexOf(d)>=0||l.indexOf(d)>=0?"kw":"id"),value:v,poi:{line:o.line,start:o.column,end:e.poi().column}}):function(e){return"(){}[]".indexOf(e)>=0}(_)?{type:"punc",value:e.next(),poi:{line:o.line,start:o.column,end:e.poi().column}}:function(e){return",;.:?".indexOf(e)>=0}(_)?{type:"sp",value:e.next(),poi:{line:o.line,start:o.column,end:e.poi().column}}:u(_)?{type:"op",value:f(u),poi:{line:o.line,start:o.column,end:e.poi().column}}:void e.croak(`Can't handle character :${_}(${_.charCodeAt(0)})`)}function v(){return t||(t=d())}}function t(e){return function(){var o=[];for(;!e.eof();)o.push(w());return{type:"top",body:o}}();function o(o){var t=e.peek();return t&&"punc"==t.type&&(!o||t.value==o)&&t}function t(o){var t=e.peek();return t&&"sp"==t.type&&(!o||t.value==o)&&t}function n(o){var t=e.peek();return t&&"kw"==t.type&&(!o||t.value==o)&&t}function l(o){var t=e.peek();return t&&"op"==t.type&&(!o||t.value==o)&&t}function i(){return"id"==e.peek().type}function a(t){o(t)?e.next():e.croak('Expecting punctuation: "'+t+'"')}function u(){var t={line:e.peek().poi.line,start:e.peek().poi.start},n=[];for(a("{");!o("}");){var l=w();l&&n.push(l)}return a("}"),{type:"BlockStatement",body:n,poi:t}}function s(){var t={type:"Arguments",body:[],poi:{line:e.peek().poi.line,start:e.peek().poi.start},value:""};for(a("(");!o(")");){var n=f();n&&(t.value+=n.value+" ",t.body.push(n))}return a(")"),t}function f(){if(t(","))return void(t(l=",")?e.next():e.croak('Expecting punctuation: "'+l+'"'));var l;if(o("{"))return u();let a=null;if(i()){if(a=e.next(),o("("))return{type:"CallExpression",value:a.value,poi:{line:a.poi.line,start:a.poi.start},body:[s()]}}else if(n("function")){if(a=e.next(),o("("))return{type:"CallExpression",value:a.value,poi:{line:a.poi.line,start:a.poi.start},body:[s()]}}else a=e.next();return{type:"Arg",value:a.value,node:a,poi:a.poi}}function p(){var t={type:"Condition",poi:{line:e.peek().poi.line,start:e.peek().poi.start},value:"",body:[]};for(a("(");!o(")");){let n=null;i()?(t.value+=e.peek().value+" ",n=e.next(),o("(")&&t.body.push({type:"CallExpression",value:n.value,poi:{line:n.poi.line,start:n.poi.start},body:[s()]})):(n=e.next(),t.value+=n.value+" ",t.body.push(n))}return a(")"),t}function c(){let n=[];for(var a={type:"Expression",poi:{line:e.peek().poi.line,start:e.peek().poi.start}};"num"==e.peek().type||"str"==e.peek().type||l()||t()||o("(")||o(")")||i();){let t=e.peek(),l=e.next();if("id"==t.type&&o("(")?n.push({type:"CallExpression",value:l.value,poi:{line:l.poi.line,start:l.poi.start},body:[s()]}):n.push(l),e.eof())break}return a.body=n,a}function d(t){e.next();if(n("new"))return v();if(n("function")){var l=e.next(),i={type:"FunctionDefine",value:t,poi:{line:l.poi.line,start:l.poi.start}};return o("(")&&(i.arguments=s()),o("{")&&(i.body=[u()]),console.log(i),i}return o("{")?u():c()}function v(){var n=e.next();if(i()){var l={type:"NewExpression",value:e.peek().value,poi:{line:n.poi.line,start:n.poi.start}},a=e.next();return o("(")?(l.body=[s()],l):"<"==e.peek().value?(l.T=e.next(),l):t(".")?v():o("{")?(l.block=u(),l):a}return console.warn("parse new",e.peek()),n}function _(){return o("(")?s():o("{")?u():n("new")?v():i()?function(){var t=e.next();if(o("(")){var n={type:"CallExpression",value:t.value,poi:{line:t.poi.line,start:t.poi.start},body:[s()]};return o("{")&&(n.type="FunctionDefine",n.body=u().body),n}return l("=")?n={type:"Variable",value:t.value,poi:{line:t.poi.line,start:t.poi.start},body:[d(t.value)]}:t}():e.next()}function w(){try{if(!o(";"))return(w=e.peek())&&"kw"==w.type&&(!v&&["public","private","protected","sealed","internal","static","class","interface","namespace"].indexOf(w.value)>=0||w.value==v)&&w?function(){for(var i={type:"",level:e.peek().value,is_sp:!1,ids:[],return_type:null,value:null,nodes:[],poi:{start:e.peek().poi.start,line:e.peek().poi.line}};!(o("(")||o("{")||l("=")||t(";"));){i.nodes.push(e.peek()),t(":")||n("extends")||n("implements")?i.is_sp=!0:n("class")?i.type="ClassDefine":n("interface")?i.type="InterfaceDefine":n("namespace")?i.type="NamespaceDefine":n("void")&&(i.return_type="void");var a=e.next();"id"==a.type&&i.ids.push(a.value)}return o("(")?(i.type="MethodDefine",i.value=i.ids.slice(-1)[0],i.return_type||(i.return_type=i.ids[0]),i.parameter=s(),t(":")&&(e.next(),i.base=e.peek(),e.next(),o("(")&&(i.base.parameter=s())),o("{")&&(i.body=u().body)):"ClassDefine"==i.type||"InterfaceDefine"==i.type||"NamespaceDefine"==i.type?(i.value=i.ids[0],i.is_sp&&(i.extends=i.ids.slice(1)),o("{")&&(i.body=u().body)):i.type||(i.type="PropertyDefine",i.value=i.ids.slice(-1)[0],l("=")&&(i.body=[d(i.value)])),i}():n("for")||n("while")||n("foreach")?(f=e.next(),o("(")?(r={type:"LoopStatement",value:f.value,poi:{line:f.poi.line,start:f.poi.start},condition:p()},o("{")&&(r.body=u().body),r):(console.warn("parse loop",e.peek()),f)):n("if")||n("else")||n("switch")?function(){var t=e.next(),l={type:"IfStatement",poi:{line:t.poi.line,start:t.poi.start},value:t.value};return n("if")&&(l.value="elif",e.next()),o("(")?(l.condition=p(),o("{")?(l.body=u().body,l):(l.body=[c()],l)):(o("{")&&(l.body=u().body),l)}():_();a(";")}catch(o){var i=e.peek();console.warn(`parse statement ${i.type} ${i.value} at ${i.poi.line}:${i.poi.start}:${i.poi.end}`,o)}var f,v,w}}var n={scastops:e,fontsize:14};return{getAst:function(e){return t(o(function(e){var o=0,t=1,n=0;return{next:function(){var l=e.charAt(o++);return"\n"==l?(t++,n=0):n++,l},peek:l,eof:function(){return""==l()},croak:function(e){throw new Error(e+" ("+t+":"+n+")")},poi:function(){return{line:t,column:n,pos:o}}};function l(t=0){return e.charAt(o+t)}}(e)))},traverseAst:function e(o,t){if(t&&t(o),o.body&&o.body.length>0)for(let n of o.body)e(n,t)},analysisMermaid:function(e,o,t){switch(e.type){case"ClassDefine":if(!t.showMethod)break;if(!1===t.FlowFilter[e.value])break;t.Flow+=`    ${e.value}[${e.value}]\nclick ${e.value} "javascript:void(onFlowClick('${e.value}','${o}'))"\n`,t.FDPNode[e.value]={id:e.value,w:e.value.length*n.fontsize/1.6+2*n.fontsize,text:`[${e.value}]`},l(e,o);break;case"InterfaceDefine":if(!t.showMethod)break;if(!1===t.FlowFilter[e.value])break;t.Flow+=`    ${e.value}{{${e.value}}}\nclick ${e.value} "javascript:void(onFlowClick('${e.value}','${o}'))"\n`,t.FDPNode[e.value]={id:e.value,w:e.value.length*n.fontsize/1.6+2*n.fontsize,text:`{${e.value}}`},l(e,o);break;case"NamespaceDefine":if(!t.showMethod)break;if(!t.showNamespace)break;namespace?t.Flow+=`  end\n  subgraph ${e.value}.namespace\n`:(t.Flow+=`  subgraph ${e.value}.namespace\n`,namespace=e.value);break;case"FunctionDefine":case"MethodDefine":if(t.showMethod)break;a(e,{},o);break;case"Variable":if(t.showMethod)break;r(e,{})}function l(e,o){e._file=o,t.FlowNode[e.value]=e,t.FlowOne[e.value]=e.value,t.UMLClass[e.value]={};var l={public:"+",private:"-",protected:"#",internal:"~",static:"$"};t.UML+=`  class ${e.value}{\n`;for(let t of e.body){let n=t.level&&l[t.level]?l[t.level]:" ";switch(t.type){case"PropertyDefine":i(t,e,o,n);break;case"MethodDefine":case"FunctionDefine":a(t,e,o,n)}}if(t.UML+="  }\n",e.extends)for(let o of e.extends)t.FlowNode[o]&&"InterfaceDefine"==t.FlowNode[o].type?(t.FDPNode[o]={id:o,w:o.length*n.fontsize/1.6+2*n.fontsize,text:`{${o}}`},t.UML+=`  ${o} <|.. ${e.value}\n`,t.FlowLink+=`${o} ==> ${e.value}\n`,t.FDPLinks.push({source:e.value,target:o,value:6,dist:200,dash:"2,2"})):(void 0===t.FDPNode[o]&&(t.FDPNode[o]={id:o,w:o.length*n.fontsize/1.6+2*n.fontsize,text:`[${o}]`}),t.UML+=`  ${o} <|-- ${e.value}\n`,t.FlowLink+=`${o} ==o ${e.value}\n`,t.FDPLinks.push({source:o,target:e.value,value:6,dist:200,dash:"2,2"}))}function i(e,o,l,i){e._flow_id=e.value+"_"+o.value,e._flow_from=o.value,e._flow_prop=`|${i}${e.value.replaceAll("|","|").replaceAll("[","").replaceAll("]","")}|`,e._file=l,!1!==t.FlowFilter[e._flow_id]&&(t.FlowNode[e._flow_id]=e,t.UML+=`    ${i}${e.value}\n`,t.showCall&&function e(l,i){if(!l.body)return;for(let a of l.body)a._file=i,a._flow_id=a.value+"_"+l._flow_id,a._flow_from=l._flow_from,a._flow_prop=l._flow_prop,t.FlowNode[a._flow_id]=a,"Expression"==a.type?(a._flow_id=l._flow_id,e(a,i)):!t.FlowFilter[a._flow_id]||"NewExpression"!=a.type&&"CallExpression"!=a.type||("NewExpression"==a.type?(t.UMLClass[o.value][a._flow_id]=a,a._flow_str=`        ${a._flow_id}[${a.value}]\nclick ${a._flow_id} "javascript:void(onFlowClick('${a._flow_id}','${i}'))"\n`,t.FDPNode[a._flow_id]={id:a._flow_id,w:a.value.length*n.fontsize/1.6,text:`${a.value}`}):(a._flow_str=`        ${a._flow_id}([${a.value}])\nclick ${a._flow_id} "javascript:void(onFlowClick('${a._flow_id}','${i}'))"\n`,t.FDPNode[a._flow_id]={id:a._flow_id,w:a.value.length*n.fontsize/1.6+2*n.fontsize,text:`${a.value}()`}),t.Flow+=a._flow_str)}(e,l))}function a(e,o,l,i){var a=o.value?e.value+"_"+o.value:e.value;t.FlowOne[e.value]=a,e._flow_id=a,e._flow_from=o.value,e._file=l,!1!==t.FlowFilter[e._flow_id]&&(t.FlowNode[e._flow_id]=e,t.FDPNode[e._flow_id]={id:e._flow_id,w:e.value.length*n.fontsize/1.6+3*n.fontsize,text:`${i||":"}${e.value}()`},i&&(t.UML+=`    ${i}${e.value}()\n`),e.base||e.value==o.value?t.Flow+=`    ${e._flow_id}(${e.value})\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${l}'))"\n`:t.Flow+=`    ${e._flow_id}([${e.value}])\nclick ${e._flow_id} "javascript:void(onFlowClick('${e._flow_id}','${l}'))"\n`,o.value&&(t.FlowLink+=`${o.value} --o ${e._flow_id}\n`,t.FDPLinks.push({source:o.value,target:e._flow_id,value:2})),t.showCall&&function e(l,i){if(!l.body)return;for(let u of l.body)u._file=i,u._flow_id=u.value+"_"+l._flow_id,u._flow_from=t.showIf?l._flow_id:a,t.FlowNode[u._flow_id]=u,"IfStatement"==u.type||"LoopStatement"==u.type?(t.showIf&&(t.Flow+="IfStatement"==u.type?`        ${u._flow_id}{${u.value}}\nclick ${u._flow_id} "javascript:void(onFlowClick('${u._flow_id}','${i}'))"\n`:`        ${u._flow_id}((${u.value}))\nclick ${u._flow_id} "javascript:void(onFlowClick('${u._flow_id}','${i}'))"\n`,t.FDPNode[u._flow_id]={id:u._flow_id,w:0,text:"IfStatement"==u.type?"🔷":"🔵"}),u.condition&&u.condition.value&&(u._flow_condition="|"+u.condition.value.replaceAll("|","｜").replaceAll("[","⌈").replaceAll("]","⌋")+"|"),e(u,i)):!t.FlowFilter[u._flow_id]||"NewExpression"!=u.type&&"CallExpression"!=u.type?"Expression"==u.type?(u._flow_id=l._flow_id,e(u,i)):"Variable"==u.type?(u._flow_id=l._flow_id,t.showMethod?e(u,i):r(u,i)):"BlockStatement"==u.type&&(u._flow_id=l._flow_id,e(u,i)):("NewExpression"==u.type?(o.value&&(t.UMLClass[o.value][u._flow_id]=u),u._flow_str=`        ${u._flow_id}[${u.value}]\nclick ${u._flow_id} "javascript:void(onFlowClick('${u._flow_id}','${i}'))"\n`,t.FDPNode[u._flow_id]={id:u._flow_id,w:u.value.length*n.fontsize/1.6,text:u.value}):(u._flow_str=`        ${u._flow_id}([${u.value}])\nclick ${u._flow_id} "javascript:void(onFlowClick('${u._flow_id}','${i}'))"\n`,t.FDPNode[u._flow_id]={id:u._flow_id,w:u.value.length*n.fontsize/1.6+2*n.fontsize,text:u.value+"()"}),t.Flow+=u._flow_str)}(e,l))}function r(e,o){t.showMethod||function e(o,l){if(!o.body)return;for(let i of o.body)i._file=l,i._flow_id=i.value+"_"+o._flow_id,i._flow_from=o._flow_id,t.FlowNode[i._flow_id]||(t.FlowNode[i._flow_id]=i,!t.FlowFilter[i._flow_id]||"NewExpression"!=i.type&&"CallExpression"!=i.type?"Expression"==i.type&&(i._flow_id=o._flow_id,e(i,l)):("NewExpression"==i.type?(i._flow_str=`        ${i._flow_id}[${i.value}]\nclick ${i._flow_id} "javascript:void(onFlowClick('${i._flow_id}','${l}'))"\n`,t.FDPNode[i._flow_id]={id:i._flow_id,w:i.value.length*n.fontsize/1.6,text:i.value}):(i._flow_str=`        ${i._flow_id}([${i.value}])\nclick ${i._flow_id} "javascript:void(onFlowClick('${i._flow_id}','${l}'))"\n`,t.FDPNode[i._flow_id]={id:i._flow_id,w:i.value.length*n.fontsize/1.6+2*n.fontsize,text:i.value+"()"}),t.Flow+=i._flow_str))}(e,o)}},analysisD3:function(e,o){if(e.children=[],e.body&&e.body.length>0)for(let o of e.body)(n.scastops[o.type]||n.scastops.all)&&e.children.push(o);switch(e.type){case"top":e.name=o,e.value=o;break;case"ClassDefine":e.name=`[ ${e.value} ]`;break;case"InterfaceDefine":e.name=`( ${e.value} )`;break;case"MethodDefine":e.level&&level_symbol[e.level]?e.name=`${level_symbol[e.level]}${e.value}()`:e.name=`:${e.value}()`;break;case"FunctionDefine":e.name=`:${e.value}()`;break;case"PropertyDefine":e.level&&level_symbol[e.level]?e.name=`${level_symbol[e.level]}${e.value}`:e.name=`${e.value}`;break;case"NamespaceDefine":e.name=e.value+".namespace";break;case"NewExpression":e.name="( "+e.value+" )";break;case"CallExpression":e.name=e.value+"()";break;default:e.name=e.value}},types:e,setD3Config:function(e){n=e}}}();