function animation(t,i,s,e){function h(){var e=(new Date).getTime(),h=e-n;for(n=e,o+=h;o>=s;)t(),o-=s;i.drawCanvas()}var n=(new Date).getTime(),o=0,s=s||20,r=Math.ceil(1e3/this.fps);return setInterval(h,r)}function showPosition(t,i){i.addTrigger("mousemove"),i.addTrigger("mousedown"),i.addTrigger("mouseup");var s=new ctFillText("["+t.x+","+t.y+"]","3px Arial","#f00",t.x,t.y);i.addObj(s);var e=new ctStrokeRect("#f00",1,t.x,t.y,t.w,t.h);i.addObj(e);var h,n,o,r,l=!1;t.on("mousedown",function(i){o=t.x,r=t.y,h=i.layerX,n=i.layerY,l=!0,console.log("x","y","width","height")}),t.on("mousemove",function(c){l&&(t.x=Math.ceil(o+(c.layerX-h)),t.y=Math.ceil(r+(c.layerY-n)),s.text="["+parseInt(t.x)+","+parseInt(t.y)+"]",s.x=t.x,s.y=t.y,e.x=t.x,e.y=t.y,i.drawCanvas())}),t.on("mouseup",function(i){l=!1,console.log(t.x,t.y,t.w,t.h)})}function showPositions(t,i){for(var s=0;s<t.length;s++)showPosition(t[s],i)}var __extends=this.__extends||function(t,i){function s(){this.constructor=t}for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);s.prototype=i.prototype,t.prototype=new s},ctCanvas=function(){function t(t){this.objs=[],this.triggers=[],this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d")}return t.prototype.reset=function(){this.objs=[];for(var t=0;t<this.triggers.length;t++)this.resetTrigger(this.triggers[t]);this.triggers=[],this.drawCanvas()},t.prototype.addObj=function(t){this.objs.push(t),t.ctcanvas=this,t.context=this.context,t.draw()},t.prototype.addObjs=function(t){for(var i=0;i<t.length;i++)this.addObj(t[i])},t.prototype.removeObj=function(t){var i=this.objs.indexOf(t);i>=0&&this.objs.splice(i,1),this.offObj(t),this.drawCanvas()},t.prototype.removeObjs=function(t){for(var i=0;i<t.length;i++)this.removeObj(t[i])},t.prototype.offObj=function(t){for(var i=0;i<this.triggers.length;i++)this.removeObserver(this.triggers[i],t)},t.prototype.drawCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.objs.length;t++)this.objs[t].draw()},t.prototype.addTrigger=function(t){if(this.triggers.indexOf(t)===-1){this.triggers.push(t),this[t+"Observers"]=[],this[t+"Functions"]=[];var i=this;this.canvas["on"+t]=function(s){i.Notify(s,t)}}},t.prototype.resetTrigger=function(t){this[t+"Observers"]=[],this[t+"Functions"]=[];var i=this;this.canvas["on"+t]=function(s){i.Notify(s,t)}},t.prototype.Notify=function(t,i){for(var s=t.layerX,e=t.layerY,h=0;h<this[i+"Observers"].length;h++){var n=this[i+"Observers"][h];s>n.x&&s<n.x+n.w&&e>n.y&&e<n.y+n.h&&this[i+"Functions"][h].call(n,t)}},t.prototype.registerObserver=function(t,i,s){this[t+"Observers"].push(s),this[t+"Functions"].push(i)},t.prototype.removeObserver=function(t,i){var s=this[t+"Observers"].indexOf(i);s>=0&&(this[t+"Observers"].splice(s,1),this[t+"Functions"].splice(s,1))},t}(),ctObj=function(){function t(t,i,s,e,h){this.x=t||0,this.y=i||0,this.w=s||100,this.h=e||100,this.alpha=h||1}return t.prototype.superdraw=function(){this.context.globalAlpha=this.alpha},t.prototype.on=function(t,i){this.ctcanvas.registerObserver(t,i,this)},t.prototype.off=function(t){this.ctcanvas.removeObserver(t,this)},t.prototype.to=function(t,i,s){var e=20,h=i/e,n=t.x?(t.x-this.x)/i*e:0,o=t.y?(t.y-this.y)/i*e:0,r=t.w?(t.w-this.w)/i*e:0,l=t.h?(t.h-this.h)/i*e:0,c=t.alpha?(t.alpha-this.alpha)/i*e:0,a=this,x=animation(function(){a.x+=n,a.y+=o,a.w+=r,a.h+=l,a.alpha+=c,h--,h<=0&&(clearInterval(x),s&&s())},this.ctcanvas,e)},t}(),ctFillRect=function(t){function i(i,s,e,h,n,o){t.call(this,s,e,h,n,o),this.fillStyle=i||"#000"}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.fillStyle=this.fillStyle,this.context.fillRect(this.x,this.y,this.w,this.h)},i}(ctObj),ctStrokeRect=function(t){function i(i,s,e,h,n,o,r){t.call(this,e,h,n,o,r),this.strokeStyle=i||"#f00",this.lineWidth=s||1}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.strokeStyle=this.strokeStyle,this.context.lineWidth=this.lineWidth,this.context.strokeRect(this.x,this.y,this.w,this.h)},i}(ctObj),ctFillText=function(t){function i(i,s,e,h,n,o,r,l){t.call(this,h,n,o,r,l),this.text=i||"",this.font=s||"40px Arial",this.fillStyle=e||"#000"}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.fillStyle=this.fillStyle,this.context.font=this.font,this.context.fillText(this.text,this.x,this.y)},i}(ctObj),ctFillCircle=function(t){function i(i,s,e,h,n){t.call(this,s-h,e-h,2*h,2*h,n),this.fillStyle=i||"#000",this.ox=s||50,this.oy=e||50,this.r=h||50,this.sangle=0,this.eangle=2*Math.PI,this.alpha=n||1,this.clockwise=!0}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.fillStyle=this.fillStyle,this.context.arc(this.x+this.r,this.y+this.r,this.r,this.sangle,this.eangle,this.clockwise),this.context.closePath(),this.context.fill()},i}(ctObj),ctDrawImg=function(t){function i(i,s,e,h,n,o,r,l,c,a){t.call(this,s,e,i.width,i.height,o),this.img=i,this.sx=r||0,this.sy=l||0,this.sw=c||i.width,this.sh=a||i.height}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.x,this.y,this.w,this.h)},i}(ctObj),ctLine=function(t){function i(i,s,e,h,n,o,r){t.call(this,1,1,1,1,r),this.strokeStyle=i,this.sx=s,this.sy=e,this.ex=h,this.ey=n,this.lineWidth=o||2}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.strokeStyle=this.strokeStyle,this.context.lineWidth=this.lineWidth,this.context.moveTo(this.sx,this.sy),this.context.lineTo(this.ex,this.ey),this.context.stroke(),this.context.closePath()},i}(ctObj),ctStrokeArc=function(t){function i(i,s,e,h,n,o,r,l,c){t.call(this,e-n,h-n,2*n,2*n,l),this.strokeStyle=i,this.lineWidth=s||2,this.ox=e||50,this.oy=h||50,this.r=n||50,this.sangle=o/180*Math.PI||0,this.eangle=r/180*Math.PI||2*Math.PI,this.alpha=l||1,this.clockwise=c||!1}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.strokeStyle=this.strokeStyle,this.context.lineWidth=this.lineWidth,this.context.arc(this.x+this.r,this.y+this.r,this.r,this.sangle,this.eangle,this.clockwise),this.context.stroke(),this.context.closePath()},i}(ctObj),ctFillArc=function(t){function i(i,s,e,h,n,o,r,l){t.call(this,s-h,e-h,2*h,2*h,r),this.fillStyle=i||"#000",this.ox=s||50,this.oy=e||50,this.r=h||50,this.sangle=n/180*Math.PI||0,this.eangle=o/180*Math.PI||2*Math.PI,this.alpha=r||1,this.clockwise=l||!0}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.fillStyle=this.fillStyle,this.context.arc(this.x+this.r,this.y+this.r,this.r,this.sangle,this.eangle,this.clockwise),this.context.lineTo(this.x+this.r,this.y+this.r),this.context.closePath(),this.context.fill()},i}(ctObj),skillArc=function(t){function i(i,s,e,h,n){t.call(this,200,200,200,200,1),this.fillStyle=i,this.ox=300,this.oy=300,this.r=h,this.sangle=s*Math.PI/180||0,this.eangle=e*Math.PI/180||2*Math.PI,this.clockwise=n||!1}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.fillStyle=this.fillStyle,this.context.arc(this.ox,this.oy,this.r,this.sangle,this.eangle,this.clockwise),this.context.lineTo(this.ox,this.oy),this.context.closePath(),this.context.fill()},i}(ctObj),skillNode=function(t){function i(i,s,e,h,n){t.call(this,e||270,h||270,60,60,n||1),this.fillStyle=s||"#555",this.nodetext=i,this.r=25}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.fillStyle=this.fillStyle,this.context.arc(this.x+30,this.y+30,this.r,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.fillStyle="#fff";var t=0;this.nodetext.length>9?(this.context.font="7px Arial",t=4):this.nodetext.length>6?(this.context.font="7px Arial",t=0):this.context.font="15px Arial",this.context.fillText(this.nodetext,this.x+t+30-this.context.measureText(this.nodetext).width/2,this.y+35,50)},i}(ctObj),timeNode=function(t){function i(i,s,e,h,n,o,r,l){this.timetitle=s,this.fillStyle=e||"#000",this.ox=h||0,this.oy=n||0,this.r=o||2,this.textalpha=r||0,t.call(this,this.ox-20,this.oy-20,40,40,l||.01),i?(this.plusx=-25,this.plusy=40):(this.plusy=0,this.plusx=40)}return __extends(i,t),i.prototype.draw=function(){this.superdraw(),this.context.beginPath(),this.context.fillStyle="#000",this.context.arc(this.x+20,this.y+20,this.r+4,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle=this.fillStyle,this.context.arc(this.x+20,this.y+20,this.r,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this.context.globalAlpha=this.textalpha,this.context.fillStyle="#fff",this.context.font="15px SimHei",this.context.fillText(this.timetitle,this.x+45+this.plusx-this.context.measureText(this.timetitle).width/2,this.y+25+this.plusy)},i}(ctObj);